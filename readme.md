# Lisp on c

翁恺老师推荐的用于学习PPL的项目：[Build Your Own Lisp](http://buildyourownlisp.com/)，此处为其[中文版](https://www.abnerchou.me/BuildYourOwnLispCn/)（网上还有另一版中文版不过翻译完整度较此版来得低）。

这是一个基于这一教程的实现，打算在原版的基础上增加一些特性。

## 待办项

**- [ ] 将原生指针替换为智能指针**

**- [ ] 使用STL容器存储诸如lenv中的项**

**- [ ] 添加缓存机制加速斐波那契数的求解**

**- [ ] 添加Lispy的说明文档**

**- [ ] 添加Lispy的标准库(lstd)的说明文档**

**- [ ] 添加入门教程，包括Lispy与Haskell的对比**

## 项目评价

### 定位

这个教程说“If you're looking to learn C...this is the book for you.”。这句话挺不负责的，因为它关于C的介绍过于简略了。推荐有一定C语言底力的玩家尝试，不过阅读教程不需要有函数式编程的基础（主要目的应该是拿它来学lisp），不需要有编译原理前端的基础。虽然项目用的是C，但其实是用面向对象的思想写的。

### 缺陷

- 所有代码都写在一个文件里，结构不是特别清晰
- 没有对代码规范（变量名等）的说明
- 命令行模式下不支持多行输入
- 没有在每次更新后做单元测试

### 各章简介

前四章讲了一些项目介绍及C语言基础，构建了一个命令行的交互程序。

第五章第六章讲了编程语言的语法规则，波兰表达式正则表达式，用正则表达式（没有提BNF）表达编程语言语法，给出了作者编写的一个解析器`mpc`及其用法，构建了一个将前缀算式转换为AST（抽象语法树）的程序。

> 所以不用C的话，可能在一些地方写得顺手，但得另找语法解析器用，或者自己出一个。
>
> 因为用的是别人的库，用之前多拿些例子跑跑提升直观感受，同时读文档。

第七章根据此前得到的AST进行求值，体现了递归的思想。

第八章涉及了错误处理，同时在这章体现了面向对象的一些方面（类、类的方法、构造函数、析构函数），但本章的错误处理似乎和常见编程语言的异常处理机制有所不同。后面章节（第十章，第十一章）使用宏实现断言用于辅助错误处理。

第九章主要是对第七章的重构，程序的功能没有改变，但是将S-表达式作为LVAL的子类添加到程序中。

第十章引入了Q-表达式即不会被解析的表达式，用于实现列表这一结构，同时给出了一些基本的列表操作方法。

第十一章讲变量，引入了环境（函数上下文），因为调用函数需要传入上下文。重写了内置函数。将任意SYMBOL视为变量并调用get函数得到SYMBOL的值。通过put函数可以将SYMBOL及其对应值传入上下文。

第十二章实现了使用lambda表达式定义自定义函数。调用函数时参数未传完整可以柯里化：返回部分参数绑定的函数，即高阶函数。因为自定义函数可能存在递归故需要完善上下文的处理机制。

第十三章引入了基本的条件判断语句：`if cond expr1 expr2`，用于实现条件分支，而在此之前要给出一些基本的比较函数。

第十四章将字符串作为基本类型引入，由此便可实现从文件中加载代码的功能。转义字符的处理是用`mpc`实现的。